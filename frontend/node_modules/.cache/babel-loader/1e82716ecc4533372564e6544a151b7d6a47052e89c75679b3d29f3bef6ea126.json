{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Quant\\\\Documents\\\\Programming\\\\Projects\\\\Hackathon\\\\MakeUofT\\\\frontend\\\\src\\\\components\\\\PoseTracker.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState, useCallback, useMemo } from 'react';\nimport Webcam from 'react-webcam';\nimport { Camera } from '@mediapipe/camera_utils';\nimport { Pose } from '@mediapipe/pose';\nimport './PoseTracker.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PoseTracker = ({\n  userPreferences\n}) => {\n  _s();\n  var _selectedPose$name;\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const poseRef = useRef(null);\n  const cameraRef = useRef(null);\n  const cleanupInProgressRef = useRef(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [poseAccuracy, setPoseAccuracy] = useState(0);\n  const [segmentAccuracies, setSegmentAccuracies] = useState({});\n  const [poseFeedback, setPoseFeedback] = useState('');\n  const [wsConnection, setWsConnection] = useState(null);\n  const [selectedPose, setSelectedPose] = useState(null);\n\n  // New state variables for pose cycling\n  const [availablePoses, setAvailablePoses] = useState([]);\n  const [currentPoseIndex, setCurrentPoseIndex] = useState(0);\n  const [timeRemaining, setTimeRemaining] = useState(15);\n  const [isSessionComplete, setIsSessionComplete] = useState(false);\n  const [totalPosesCompleted, setTotalPosesCompleted] = useState(0);\n\n  // Add new state variables for session control\n  const [isSessionStarted, setIsSessionStarted] = useState(false);\n  const [isPaused, setIsPaused] = useState(false);\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  // Constants\n  const POSE_DURATION = 15; // seconds\n  const poseNames = ['crescent-lunge', 'dancers-pose', 'high-plank-pose', 'mountain-pose', 'seated-forward-fold', 'tree-pose', 'triangle-pose', 'upward-facing-dog'];\n\n  // Memoize video constraints\n  const videoConstraints = useMemo(() => ({\n    width: 640,\n    height: 480,\n    facingMode: 'user',\n    frameRate: 24 // Limit frame rate\n  }), []);\n\n  // Memoize pose options\n  const poseOptions = useMemo(() => ({\n    modelComplexity: 1,\n    smoothLandmarks: true,\n    enableSegmentation: false,\n    smoothSegmentation: false,\n    minDetectionConfidence: 0.5,\n    minTrackingConfidence: 0.5,\n    selfieMode: true\n  }), []);\n\n  // Debounce pose accuracy updates\n  const [lastAccuracyUpdate, setLastAccuracyUpdate] = useState(0);\n  const ACCURACY_UPDATE_INTERVAL = 100; // Update accuracy every 100ms\n\n  const calculatePoseAccuracy = (userLandmarks, targetPose) => {\n    if (!targetPose || !userLandmarks) return {\n      total: 0,\n      segments: {}\n    };\n\n    // Define body segments with their corresponding landmark indices\n    const bodySegments = {\n      head: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],\n      upperBody: [11, 12, 13, 14, 15, 16],\n      // shoulders, elbows, wrists\n      torso: [11, 12, 23, 24],\n      // shoulders to hips\n      lowerBody: [23, 24, 25, 26, 27, 28] // hips to ankles\n    };\n\n    // Define key points that must be visible for each segment\n    const requiredPoints = {\n      head: [0, 1, 4],\n      // Nose and eyes\n      upperBody: [11, 12],\n      // Shoulders\n      torso: [11, 12, 23, 24],\n      // Shoulders and hips\n      lowerBody: [23, 24, 25, 26] // Hips and knees\n    };\n\n    // Helper function to normalize pose relative to shoulders\n    const normalizePose = landmarks => {\n      const leftShoulder = landmarks[11];\n      const rightShoulder = landmarks[12];\n      const shoulderCenterX = (leftShoulder.x + rightShoulder.x) / 2;\n      const shoulderCenterY = (leftShoulder.y + rightShoulder.y) / 2;\n      const shoulderWidth = Math.sqrt(Math.pow(rightShoulder.x - leftShoulder.x, 2) + Math.pow(rightShoulder.y - leftShoulder.y, 2));\n      return landmarks.map(landmark => ({\n        x: (landmark.x - shoulderCenterX) / shoulderWidth,\n        y: (landmark.y - shoulderCenterY) / shoulderWidth,\n        visibility: landmark.visibility\n      }));\n    };\n\n    // Normalize both poses\n    const normalizedUser = normalizePose(userLandmarks);\n    const normalizedTarget = normalizePose(targetPose.landmarks);\n    let segmentAccuracies = {};\n    let visibleSegments = 0;\n\n    // Calculate accuracy for each body segment\n    for (const [segment, points] of Object.entries(bodySegments)) {\n      // Check if required points are visible\n      const requiredVisible = requiredPoints[segment].every(index => {\n        const userPoint = normalizedUser[index];\n        const targetPoint = normalizedTarget[index];\n        return userPoint.visibility > 0.5 && targetPoint.visibility > 0.5;\n      });\n      if (!requiredVisible) {\n        continue; // Skip this segment if required points aren't visible\n      }\n      let segmentTotal = 0;\n      let segmentPoints = 0;\n\n      // Calculate accuracies for points\n      points.forEach(index => {\n        const userLandmark = normalizedUser[index];\n        const targetLandmark = normalizedTarget[index];\n\n        // Check if point is visible enough in both poses\n        if (userLandmark.visibility > 0.5 && targetLandmark.visibility > 0.5) {\n          // Calculate angle between points relative to shoulder center\n          const userAngle = Math.atan2(userLandmark.y, userLandmark.x);\n          const targetAngle = Math.atan2(targetLandmark.y, targetLandmark.x);\n          const angleDiff = Math.abs(userAngle - targetAngle);\n\n          // Calculate position difference\n          const distance = Math.sqrt(Math.pow(userLandmark.x - targetLandmark.x, 2) + Math.pow(userLandmark.y - targetLandmark.y, 2));\n\n          // Combine angle and distance accuracy\n          const angleAccuracy = Math.max(0, 1 - angleDiff / Math.PI);\n          const distanceAccuracy = Math.max(0, 1 - distance / 0.5);\n          const pointAccuracy = angleAccuracy * 0.7 + distanceAccuracy * 0.3;\n\n          // Add to segment total with visibility weight\n          const weight = Math.min(userLandmark.visibility, targetLandmark.visibility);\n          segmentTotal += pointAccuracy * weight;\n          segmentPoints += weight;\n        }\n      });\n\n      // Calculate segment accuracy if we have points\n      if (segmentPoints > 0) {\n        const rawAccuracy = segmentTotal / segmentPoints * 100;\n        segmentAccuracies[segment] = {\n          accuracy: Math.min(100, Math.max(0, rawAccuracy)),\n          visibility: segmentPoints / points.length\n        };\n        visibleSegments++;\n      }\n    }\n\n    // Calculate overall accuracy\n    if (visibleSegments === 0) return {\n      total: 0,\n      segments: {}\n    };\n    let totalAccuracy = 0;\n    let totalWeight = 0;\n\n    // Weight segments differently\n    const segmentWeights = {\n      head: 1,\n      upperBody: 1.2,\n      torso: 1.2,\n      lowerBody: 1\n    };\n    for (const [segment, data] of Object.entries(segmentAccuracies)) {\n      const weight = segmentWeights[segment] * data.visibility;\n      totalAccuracy += data.accuracy * weight;\n      totalWeight += weight;\n    }\n    return {\n      total: Math.round(totalWeight > 0 ? totalAccuracy / totalWeight : 0),\n      segments: segmentAccuracies\n    };\n  };\n\n  // Optimize drawing function\n  const drawPose = useCallback((canvasCtx, landmarks, videoWidth, videoHeight) => {\n    if (!canvasCtx || !landmarks) return;\n\n    // Clear canvas with opacity for motion trail effect\n    canvasCtx.fillStyle = 'rgba(0, 0, 0, 0.1)';\n    canvasCtx.fillRect(0, 0, videoWidth, videoHeight);\n\n    // Draw connections with optimized batching\n    canvasCtx.beginPath();\n    canvasCtx.lineWidth = 3;\n\n    // Define connection groups for batch drawing\n    const connections = {\n      head: [[0, 1], [1, 2], [2, 3], [3, 7], [0, 4], [4, 5], [5, 6], [6, 8]],\n      upperBody: [[11, 12], [11, 13], [13, 15], [12, 14], [14, 16]],\n      torso: [[11, 23], [12, 24], [23, 24]],\n      lowerBody: [[23, 25], [25, 27], [24, 26], [26, 28]]\n    };\n\n    // Draw connections in batches\n    Object.entries(connections).forEach(([part, lines]) => {\n      let color;\n      switch (part) {\n        case 'head':\n          color = '#FF0000';\n          break;\n        case 'upperBody':\n          color = '#00FF00';\n          break;\n        case 'torso':\n          color = '#0000FF';\n          break;\n        case 'lowerBody':\n          color = '#FFFF00';\n          break;\n        default:\n          color = '#FFFFFF';\n      }\n      canvasCtx.strokeStyle = color;\n      canvasCtx.beginPath();\n      lines.forEach(([start, end]) => {\n        const startPoint = landmarks[start];\n        const endPoint = landmarks[end];\n        if (startPoint.visibility > 0.5 && endPoint.visibility > 0.5) {\n          canvasCtx.moveTo(startPoint.x * videoWidth, startPoint.y * videoHeight);\n          canvasCtx.lineTo(endPoint.x * videoWidth, endPoint.y * videoHeight);\n        }\n      });\n      canvasCtx.stroke();\n    });\n\n    // Batch draw landmarks\n    canvasCtx.fillStyle = '#FFFFFF';\n    canvasCtx.strokeStyle = '#000000';\n    landmarks.forEach(landmark => {\n      if (landmark.visibility > 0.5) {\n        canvasCtx.beginPath();\n        canvasCtx.arc(landmark.x * videoWidth, landmark.y * videoHeight, 3,\n        // Reduced point size\n        0, 2 * Math.PI);\n        canvasCtx.fill();\n        canvasCtx.stroke();\n      }\n    });\n  }, []);\n\n  // Optimize onResults callback\n  const onResults = useCallback(results => {\n    if (!canvasRef.current || !results.poseLandmarks) return;\n    const canvasElement = canvasRef.current;\n    const canvasCtx = canvasElement.getContext('2d', {\n      alpha: false\n    }); // Disable alpha for better performance\n    const videoWidth = webcamRef.current.video.videoWidth;\n    const videoHeight = webcamRef.current.video.videoHeight;\n\n    // Set canvas dimensions only if they've changed\n    if (canvasElement.width !== videoWidth) {\n      canvasElement.width = videoWidth;\n    }\n    if (canvasElement.height !== videoHeight) {\n      canvasElement.height = videoHeight;\n    }\n\n    // Draw pose\n    drawPose(canvasCtx, results.poseLandmarks, videoWidth, videoHeight);\n\n    // Throttle accuracy calculations\n    const now = Date.now();\n    if (now - lastAccuracyUpdate >= ACCURACY_UPDATE_INTERVAL) {\n      if (selectedPose) {\n        const accuracyData = calculatePoseAccuracy(results.poseLandmarks, selectedPose);\n        setPoseAccuracy(accuracyData.total);\n        setSegmentAccuracies(accuracyData.segments);\n      }\n      setLastAccuracyUpdate(now);\n    }\n  }, [selectedPose, lastAccuracyUpdate, drawPose]);\n  useEffect(() => {\n    const loadPoses = async () => {\n      try {\n        setIsLoading(true);\n        setError(null);\n\n        // Default to 1 pose if no preferences\n        const count = (userPreferences === null || userPreferences === void 0 ? void 0 : userPreferences.poseCount) || 1;\n        console.log('Loading poses with count:', count);\n\n        // Load all poses up to the user's poseCount\n        const posesToLoad = poseNames.slice(0, count);\n        console.log('Poses to load:', posesToLoad);\n        const loadedPoses = await Promise.all(posesToLoad.map(async poseName => {\n          try {\n            const response = await fetch(`/pose_results/${poseName}_pose.json`);\n            if (!response.ok) {\n              throw new Error(`Failed to load pose: ${poseName}`);\n            }\n            const poseData = await response.json();\n            return {\n              ...poseData,\n              name: poseName\n            };\n          } catch (err) {\n            console.error(`Error loading pose ${poseName}:`, err);\n            throw err;\n          }\n        }));\n        console.log('Loaded poses:', loadedPoses);\n        setAvailablePoses(loadedPoses);\n        if (loadedPoses.length > 0) {\n          setSelectedPose(loadedPoses[0]);\n        }\n        setIsLoading(false);\n      } catch (err) {\n        console.error('Error loading pose data:', err);\n        setError('Failed to load pose data. Please check your internet connection and try again.');\n        setIsLoading(false);\n      }\n    };\n    if (userPreferences) {\n      loadPoses();\n    }\n  }, [userPreferences]);\n  const cleanup = useCallback(() => {\n    if (cleanupInProgressRef.current) return;\n    cleanupInProgressRef.current = true;\n    try {\n      if (cameraRef.current) {\n        cameraRef.current.stop();\n        cameraRef.current = null;\n      }\n      if (poseRef.current) {\n        poseRef.current.close();\n        poseRef.current = null;\n      }\n    } catch (err) {\n      console.error('Error during cleanup:', err);\n    } finally {\n      cleanupInProgressRef.current = false;\n    }\n  }, []);\n\n  // Timer effect for pose cycling\n  useEffect(() => {\n    if (!availablePoses.length || isSessionComplete || !isSessionStarted || isPaused) return;\n    const timer = setInterval(() => {\n      setTimeRemaining(prev => {\n        if (prev <= 1) {\n          // Time to switch poses\n          setCurrentPoseIndex(currentIndex => {\n            const nextIndex = currentIndex + 1;\n            // Increment completed poses count for the pose that just finished\n            setTotalPosesCompleted(prev => prev + 1);\n            if (nextIndex >= availablePoses.length) {\n              setIsSessionComplete(true);\n              cleanup();\n              return currentIndex;\n            }\n            setSelectedPose(availablePoses[nextIndex]);\n            return nextIndex;\n          });\n          return POSE_DURATION;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n    return () => clearInterval(timer);\n  }, [availablePoses, isSessionComplete, cleanup, isSessionStarted, isPaused]);\n\n  // Handler for starting the session\n  const handleStartSession = useCallback(() => {\n    setIsSessionStarted(true);\n    setIsPaused(false);\n    setTimeRemaining(POSE_DURATION);\n    setTotalPosesCompleted(0);\n  }, []);\n\n  // Handler for pausing/resuming the session\n  const handlePauseResume = useCallback(() => {\n    setIsPaused(prev => !prev);\n  }, []);\n\n  // Handler for resetting the session\n  const handleReset = useCallback(() => {\n    cleanup();\n    setIsSessionStarted(false);\n    setIsPaused(false);\n    setIsSessionComplete(false);\n    setCurrentPoseIndex(0);\n    setTimeRemaining(POSE_DURATION);\n    setTotalPosesCompleted(0);\n    if (availablePoses.length > 0) {\n      setSelectedPose(availablePoses[0]);\n    }\n  }, [cleanup, availablePoses]);\n\n  // Initialize MediaPipe Pose with optimized settings\n  useEffect(() => {\n    const initializePose = async () => {\n      try {\n        var _webcamRef$current;\n        setIsLoading(true);\n        setError(null);\n        cleanup();\n        const pose = new Pose({\n          locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`\n        });\n        pose.setOptions(poseOptions);\n        await pose.initialize();\n        pose.onResults(onResults);\n        poseRef.current = pose;\n        if ((_webcamRef$current = webcamRef.current) !== null && _webcamRef$current !== void 0 && _webcamRef$current.video) {\n          const camera = new Camera(webcamRef.current.video, {\n            onFrame: async () => {\n              var _webcamRef$current2;\n              if ((_webcamRef$current2 = webcamRef.current) !== null && _webcamRef$current2 !== void 0 && _webcamRef$current2.video && poseRef.current && !cleanupInProgressRef.current) {\n                try {\n                  await poseRef.current.send({\n                    image: webcamRef.current.video,\n                    timestamp: Date.now() // Add timestamp for better tracking\n                  });\n                } catch (err) {\n                  var _err$message;\n                  if (!((_err$message = err.message) !== null && _err$message !== void 0 && _err$message.includes('already deleted'))) {\n                    console.error('Error in pose detection frame:', err);\n                  }\n                }\n              }\n            },\n            width: videoConstraints.width,\n            height: videoConstraints.height,\n            frameRate: videoConstraints.frameRate\n          });\n          await camera.start();\n          cameraRef.current = camera;\n          setIsLoading(false);\n        }\n        setIsInitialized(true);\n      } catch (err) {\n        console.error('Error initializing pose detection:', err);\n        setError('Failed to initialize pose detection. Please ensure you have granted camera permissions and try again.');\n        setIsLoading(false);\n      }\n    };\n    const timeoutId = setTimeout(() => {\n      var _webcamRef$current3;\n      if ((_webcamRef$current3 = webcamRef.current) !== null && _webcamRef$current3 !== void 0 && _webcamRef$current3.video) {\n        initializePose();\n      }\n    }, 1000);\n    return () => {\n      clearTimeout(timeoutId);\n      cleanup();\n    };\n  }, [onResults, cleanup, poseOptions, videoConstraints]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n  useEffect(() => {\n    // Initialize WebSocket connection\n    const ws = new WebSocket('ws://localhost:8000/ws/pose-feedback');\n    ws.onopen = () => {\n      console.log('Connected to feedback server');\n      setWsConnection(ws);\n    };\n    ws.onmessage = event => {\n      setPoseFeedback(event.data);\n    };\n    ws.onerror = error => {\n      console.error('WebSocket error:', error);\n    };\n    return () => {\n      if (ws) {\n        ws.close();\n      }\n    };\n  }, []);\n\n  // Send pose data to backend when accuracy updates\n  useEffect(() => {\n    if (wsConnection && selectedPose && Object.keys(segmentAccuracies).length > 0) {\n      const poseData = {\n        pose_name: selectedPose.name || 'unknown pose',\n        overall_accuracy: poseAccuracy,\n        segment_accuracies: segmentAccuracies\n      };\n      wsConnection.send(JSON.stringify(poseData));\n    }\n  }, [poseAccuracy, segmentAccuracies, selectedPose, wsConnection]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pose-tracker\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pose-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Pose Tracking\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 529,\n        columnNumber: 17\n      }, this), !isSessionComplete ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: !isSessionStarted ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"session-controls\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Ready to start your yoga session?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 534,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"You will perform \", availablePoses.length, \" poses, holding each for \", POSE_DURATION, \" seconds.\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 535,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"start-button\",\n            onClick: handleStartSession,\n            disabled: !isInitialized || isLoading,\n            children: \"Start Session\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 536,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 533,\n          columnNumber: 29\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pose-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: [\"Current Pose: \", selectedPose === null || selectedPose === void 0 ? void 0 : (_selectedPose$name = selectedPose.name) === null || _selectedPose$name === void 0 ? void 0 : _selectedPose$name.replace(/-/g, ' ').replace(/_pose$/, '')]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 546,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"timer\",\n            children: [\"Time Remaining: \", timeRemaining, \"s\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 547,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"progress\",\n            children: [\"Pose \", currentPoseIndex + 1, \" of \", availablePoses.length || (userPreferences === null || userPreferences === void 0 ? void 0 : userPreferences.poseCount) || 1]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 548,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"session-controls\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: `control-button ${isPaused ? 'resume' : 'pause'}`,\n              onClick: handlePauseResume,\n              children: isPaused ? 'Resume' : 'Pause'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 552,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"control-button reset\",\n              onClick: handleReset,\n              children: \"Reset\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 558,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 551,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 545,\n          columnNumber: 29\n        }, this)\n      }, void 0, false) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"session-complete\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Session Complete!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 570,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"You completed \", totalPosesCompleted, \" poses\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 571,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"start-button\",\n          onClick: handleReset,\n          children: \"Start New Session\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 572,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 569,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 528,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pose-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"webcam-section\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"webcam-container\",\n          children: [/*#__PURE__*/_jsxDEV(Webcam, {\n            ref: webcamRef,\n            videoConstraints: videoConstraints,\n            style: {\n              display: 'block'\n            },\n            mirrored: true,\n            onUserMediaError: err => {\n              console.error('Webcam error:', err);\n              setError('Failed to access camera. Please ensure you have granted camera permissions.');\n              setIsLoading(false);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 585,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n            ref: canvasRef,\n            className: \"pose-canvas\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 596,\n            columnNumber: 25\n          }, this), isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"loading-overlay\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"loading-spinner\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 599,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: \"Loading pose detection...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 600,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 598,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 584,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 583,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"stats-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"accuracy-card\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Overall Accuracy\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 608,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"accuracy-value\",\n            children: [poseAccuracy, \"%\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 609,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 607,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"segment-accuracies\",\n          children: Object.entries(segmentAccuracies).map(([segment, data]) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"segment-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: segment.replace(/([A-Z])/g, ' $1').trim()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 615,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"accuracy-bar\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"accuracy-fill\",\n                style: {\n                  width: `${data.accuracy}%`\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 617,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 616,\n              columnNumber: 33\n            }, this)]\n          }, segment, true, {\n            fileName: _jsxFileName,\n            lineNumber: 614,\n            columnNumber: 29\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 612,\n          columnNumber: 21\n        }, this), poseFeedback && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"feedback-message\",\n          children: poseFeedback\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 627,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 606,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 582,\n      columnNumber: 13\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-message\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 636,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"retry-button\",\n        onClick: () => {\n          setError(null);\n          window.location.reload();\n        },\n        children: \"Retry\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 637,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 635,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 527,\n    columnNumber: 9\n  }, this);\n};\n_s(PoseTracker, \"rATxOvOYj+iNYrRSRDWByDA92/Q=\");\n_c = PoseTracker;\nexport default PoseTracker;\nvar _c;\n$RefreshReg$(_c, \"PoseTracker\");","map":{"version":3,"names":["React","useRef","useEffect","useState","useCallback","useMemo","Webcam","Camera","Pose","jsxDEV","_jsxDEV","Fragment","_Fragment","PoseTracker","userPreferences","_s","_selectedPose$name","webcamRef","canvasRef","poseRef","cameraRef","cleanupInProgressRef","isLoading","setIsLoading","error","setError","poseAccuracy","setPoseAccuracy","segmentAccuracies","setSegmentAccuracies","poseFeedback","setPoseFeedback","wsConnection","setWsConnection","selectedPose","setSelectedPose","availablePoses","setAvailablePoses","currentPoseIndex","setCurrentPoseIndex","timeRemaining","setTimeRemaining","isSessionComplete","setIsSessionComplete","totalPosesCompleted","setTotalPosesCompleted","isSessionStarted","setIsSessionStarted","isPaused","setIsPaused","isInitialized","setIsInitialized","POSE_DURATION","poseNames","videoConstraints","width","height","facingMode","frameRate","poseOptions","modelComplexity","smoothLandmarks","enableSegmentation","smoothSegmentation","minDetectionConfidence","minTrackingConfidence","selfieMode","lastAccuracyUpdate","setLastAccuracyUpdate","ACCURACY_UPDATE_INTERVAL","calculatePoseAccuracy","userLandmarks","targetPose","total","segments","bodySegments","head","upperBody","torso","lowerBody","requiredPoints","normalizePose","landmarks","leftShoulder","rightShoulder","shoulderCenterX","x","shoulderCenterY","y","shoulderWidth","Math","sqrt","pow","map","landmark","visibility","normalizedUser","normalizedTarget","visibleSegments","segment","points","Object","entries","requiredVisible","every","index","userPoint","targetPoint","segmentTotal","segmentPoints","forEach","userLandmark","targetLandmark","userAngle","atan2","targetAngle","angleDiff","abs","distance","angleAccuracy","max","PI","distanceAccuracy","pointAccuracy","weight","min","rawAccuracy","accuracy","length","totalAccuracy","totalWeight","segmentWeights","data","round","drawPose","canvasCtx","videoWidth","videoHeight","fillStyle","fillRect","beginPath","lineWidth","connections","part","lines","color","strokeStyle","start","end","startPoint","endPoint","moveTo","lineTo","stroke","arc","fill","onResults","results","current","poseLandmarks","canvasElement","getContext","alpha","video","now","Date","accuracyData","loadPoses","count","poseCount","console","log","posesToLoad","slice","loadedPoses","Promise","all","poseName","response","fetch","ok","Error","poseData","json","name","err","cleanup","stop","close","timer","setInterval","prev","currentIndex","nextIndex","clearInterval","handleStartSession","handlePauseResume","handleReset","initializePose","_webcamRef$current","pose","locateFile","file","setOptions","initialize","camera","onFrame","_webcamRef$current2","send","image","timestamp","_err$message","message","includes","timeoutId","setTimeout","_webcamRef$current3","clearTimeout","ws","WebSocket","onopen","onmessage","event","onerror","keys","pose_name","overall_accuracy","segment_accuracies","JSON","stringify","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","replace","ref","style","display","mirrored","onUserMediaError","trim","window","location","reload","_c","$RefreshReg$"],"sources":["C:/Users/Quant/Documents/Programming/Projects/Hackathon/MakeUofT/frontend/src/components/PoseTracker.js"],"sourcesContent":["import React, { useRef, useEffect, useState, useCallback, useMemo } from 'react';\r\nimport Webcam from 'react-webcam';\r\nimport { Camera } from '@mediapipe/camera_utils';\r\nimport { Pose } from '@mediapipe/pose';\r\nimport './PoseTracker.css';\r\n\r\nconst PoseTracker = ({ userPreferences }) => {\r\n    const webcamRef = useRef(null);\r\n    const canvasRef = useRef(null);\r\n    const poseRef = useRef(null);\r\n    const cameraRef = useRef(null);\r\n    const cleanupInProgressRef = useRef(false);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const [poseAccuracy, setPoseAccuracy] = useState(0);\r\n    const [segmentAccuracies, setSegmentAccuracies] = useState({});\r\n    const [poseFeedback, setPoseFeedback] = useState('');\r\n    const [wsConnection, setWsConnection] = useState(null);\r\n    const [selectedPose, setSelectedPose] = useState(null);\r\n\r\n    // New state variables for pose cycling\r\n    const [availablePoses, setAvailablePoses] = useState([]);\r\n    const [currentPoseIndex, setCurrentPoseIndex] = useState(0);\r\n    const [timeRemaining, setTimeRemaining] = useState(15);\r\n    const [isSessionComplete, setIsSessionComplete] = useState(false);\r\n    const [totalPosesCompleted, setTotalPosesCompleted] = useState(0);\r\n\r\n    // Add new state variables for session control\r\n    const [isSessionStarted, setIsSessionStarted] = useState(false);\r\n    const [isPaused, setIsPaused] = useState(false);\r\n    const [isInitialized, setIsInitialized] = useState(false);\r\n\r\n    // Constants\r\n    const POSE_DURATION = 15; // seconds\r\n    const poseNames = [\r\n        'crescent-lunge',\r\n        'dancers-pose',\r\n        'high-plank-pose',\r\n        'mountain-pose',\r\n        'seated-forward-fold',\r\n        'tree-pose',\r\n        'triangle-pose',\r\n        'upward-facing-dog'\r\n    ];\r\n\r\n    // Memoize video constraints\r\n    const videoConstraints = useMemo(() => ({\r\n        width: 640,\r\n        height: 480,\r\n        facingMode: 'user',\r\n        frameRate: 24, // Limit frame rate\r\n    }), []);\r\n\r\n    // Memoize pose options\r\n    const poseOptions = useMemo(() => ({\r\n        modelComplexity: 1,\r\n        smoothLandmarks: true,\r\n        enableSegmentation: false,\r\n        smoothSegmentation: false,\r\n        minDetectionConfidence: 0.5,\r\n        minTrackingConfidence: 0.5,\r\n        selfieMode: true,\r\n    }), []);\r\n\r\n    // Debounce pose accuracy updates\r\n    const [lastAccuracyUpdate, setLastAccuracyUpdate] = useState(0);\r\n    const ACCURACY_UPDATE_INTERVAL = 100; // Update accuracy every 100ms\r\n\r\n    const calculatePoseAccuracy = (userLandmarks, targetPose) => {\r\n        if (!targetPose || !userLandmarks) return { total: 0, segments: {} };\r\n\r\n        // Define body segments with their corresponding landmark indices\r\n        const bodySegments = {\r\n            head: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],\r\n            upperBody: [11, 12, 13, 14, 15, 16], // shoulders, elbows, wrists\r\n            torso: [11, 12, 23, 24], // shoulders to hips\r\n            lowerBody: [23, 24, 25, 26, 27, 28] // hips to ankles\r\n        };\r\n\r\n        // Define key points that must be visible for each segment\r\n        const requiredPoints = {\r\n            head: [0, 1, 4], // Nose and eyes\r\n            upperBody: [11, 12], // Shoulders\r\n            torso: [11, 12, 23, 24], // Shoulders and hips\r\n            lowerBody: [23, 24, 25, 26] // Hips and knees\r\n        };\r\n\r\n        // Helper function to normalize pose relative to shoulders\r\n        const normalizePose = (landmarks) => {\r\n            const leftShoulder = landmarks[11];\r\n            const rightShoulder = landmarks[12];\r\n\r\n            const shoulderCenterX = (leftShoulder.x + rightShoulder.x) / 2;\r\n            const shoulderCenterY = (leftShoulder.y + rightShoulder.y) / 2;\r\n            const shoulderWidth = Math.sqrt(\r\n                Math.pow(rightShoulder.x - leftShoulder.x, 2) +\r\n                Math.pow(rightShoulder.y - leftShoulder.y, 2)\r\n            );\r\n\r\n            return landmarks.map(landmark => ({\r\n                x: (landmark.x - shoulderCenterX) / shoulderWidth,\r\n                y: (landmark.y - shoulderCenterY) / shoulderWidth,\r\n                visibility: landmark.visibility\r\n            }));\r\n        };\r\n\r\n        // Normalize both poses\r\n        const normalizedUser = normalizePose(userLandmarks);\r\n        const normalizedTarget = normalizePose(targetPose.landmarks);\r\n\r\n        let segmentAccuracies = {};\r\n        let visibleSegments = 0;\r\n\r\n        // Calculate accuracy for each body segment\r\n        for (const [segment, points] of Object.entries(bodySegments)) {\r\n            // Check if required points are visible\r\n            const requiredVisible = requiredPoints[segment].every(index => {\r\n                const userPoint = normalizedUser[index];\r\n                const targetPoint = normalizedTarget[index];\r\n                return userPoint.visibility > 0.5 && targetPoint.visibility > 0.5;\r\n            });\r\n\r\n            if (!requiredVisible) {\r\n                continue; // Skip this segment if required points aren't visible\r\n            }\r\n\r\n            let segmentTotal = 0;\r\n            let segmentPoints = 0;\r\n\r\n            // Calculate accuracies for points\r\n            points.forEach(index => {\r\n                const userLandmark = normalizedUser[index];\r\n                const targetLandmark = normalizedTarget[index];\r\n\r\n                // Check if point is visible enough in both poses\r\n                if (userLandmark.visibility > 0.5 && targetLandmark.visibility > 0.5) {\r\n                    // Calculate angle between points relative to shoulder center\r\n                    const userAngle = Math.atan2(userLandmark.y, userLandmark.x);\r\n                    const targetAngle = Math.atan2(targetLandmark.y, targetLandmark.x);\r\n                    const angleDiff = Math.abs(userAngle - targetAngle);\r\n\r\n                    // Calculate position difference\r\n                    const distance = Math.sqrt(\r\n                        Math.pow(userLandmark.x - targetLandmark.x, 2) +\r\n                        Math.pow(userLandmark.y - targetLandmark.y, 2)\r\n                    );\r\n\r\n                    // Combine angle and distance accuracy\r\n                    const angleAccuracy = Math.max(0, 1 - (angleDiff / Math.PI));\r\n                    const distanceAccuracy = Math.max(0, 1 - (distance / 0.5));\r\n                    const pointAccuracy = (angleAccuracy * 0.7 + distanceAccuracy * 0.3);\r\n\r\n                    // Add to segment total with visibility weight\r\n                    const weight = Math.min(userLandmark.visibility, targetLandmark.visibility);\r\n                    segmentTotal += pointAccuracy * weight;\r\n                    segmentPoints += weight;\r\n                }\r\n            });\r\n\r\n            // Calculate segment accuracy if we have points\r\n            if (segmentPoints > 0) {\r\n                const rawAccuracy = (segmentTotal / segmentPoints) * 100;\r\n                segmentAccuracies[segment] = {\r\n                    accuracy: Math.min(100, Math.max(0, rawAccuracy)),\r\n                    visibility: segmentPoints / points.length\r\n                };\r\n                visibleSegments++;\r\n            }\r\n        }\r\n\r\n        // Calculate overall accuracy\r\n        if (visibleSegments === 0) return { total: 0, segments: {} };\r\n\r\n        let totalAccuracy = 0;\r\n        let totalWeight = 0;\r\n\r\n        // Weight segments differently\r\n        const segmentWeights = {\r\n            head: 1,\r\n            upperBody: 1.2,\r\n            torso: 1.2,\r\n            lowerBody: 1\r\n        };\r\n\r\n        for (const [segment, data] of Object.entries(segmentAccuracies)) {\r\n            const weight = segmentWeights[segment] * data.visibility;\r\n            totalAccuracy += data.accuracy * weight;\r\n            totalWeight += weight;\r\n        }\r\n\r\n        return {\r\n            total: Math.round(totalWeight > 0 ? totalAccuracy / totalWeight : 0),\r\n            segments: segmentAccuracies\r\n        };\r\n    };\r\n\r\n    // Optimize drawing function\r\n    const drawPose = useCallback((canvasCtx, landmarks, videoWidth, videoHeight) => {\r\n        if (!canvasCtx || !landmarks) return;\r\n\r\n        // Clear canvas with opacity for motion trail effect\r\n        canvasCtx.fillStyle = 'rgba(0, 0, 0, 0.1)';\r\n        canvasCtx.fillRect(0, 0, videoWidth, videoHeight);\r\n\r\n        // Draw connections with optimized batching\r\n        canvasCtx.beginPath();\r\n        canvasCtx.lineWidth = 3;\r\n\r\n        // Define connection groups for batch drawing\r\n        const connections = {\r\n            head: [[0, 1], [1, 2], [2, 3], [3, 7], [0, 4], [4, 5], [5, 6], [6, 8]],\r\n            upperBody: [[11, 12], [11, 13], [13, 15], [12, 14], [14, 16]],\r\n            torso: [[11, 23], [12, 24], [23, 24]],\r\n            lowerBody: [[23, 25], [25, 27], [24, 26], [26, 28]]\r\n        };\r\n\r\n        // Draw connections in batches\r\n        Object.entries(connections).forEach(([part, lines]) => {\r\n            let color;\r\n            switch (part) {\r\n                case 'head': color = '#FF0000'; break;\r\n                case 'upperBody': color = '#00FF00'; break;\r\n                case 'torso': color = '#0000FF'; break;\r\n                case 'lowerBody': color = '#FFFF00'; break;\r\n                default: color = '#FFFFFF';\r\n            }\r\n\r\n            canvasCtx.strokeStyle = color;\r\n            canvasCtx.beginPath();\r\n\r\n            lines.forEach(([start, end]) => {\r\n                const startPoint = landmarks[start];\r\n                const endPoint = landmarks[end];\r\n\r\n                if (startPoint.visibility > 0.5 && endPoint.visibility > 0.5) {\r\n                    canvasCtx.moveTo(startPoint.x * videoWidth, startPoint.y * videoHeight);\r\n                    canvasCtx.lineTo(endPoint.x * videoWidth, endPoint.y * videoHeight);\r\n                }\r\n            });\r\n\r\n            canvasCtx.stroke();\r\n        });\r\n\r\n        // Batch draw landmarks\r\n        canvasCtx.fillStyle = '#FFFFFF';\r\n        canvasCtx.strokeStyle = '#000000';\r\n\r\n        landmarks.forEach(landmark => {\r\n            if (landmark.visibility > 0.5) {\r\n                canvasCtx.beginPath();\r\n                canvasCtx.arc(\r\n                    landmark.x * videoWidth,\r\n                    landmark.y * videoHeight,\r\n                    3, // Reduced point size\r\n                    0,\r\n                    2 * Math.PI\r\n                );\r\n                canvasCtx.fill();\r\n                canvasCtx.stroke();\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    // Optimize onResults callback\r\n    const onResults = useCallback((results) => {\r\n        if (!canvasRef.current || !results.poseLandmarks) return;\r\n\r\n        const canvasElement = canvasRef.current;\r\n        const canvasCtx = canvasElement.getContext('2d', { alpha: false }); // Disable alpha for better performance\r\n        const videoWidth = webcamRef.current.video.videoWidth;\r\n        const videoHeight = webcamRef.current.video.videoHeight;\r\n\r\n        // Set canvas dimensions only if they've changed\r\n        if (canvasElement.width !== videoWidth) {\r\n            canvasElement.width = videoWidth;\r\n        }\r\n        if (canvasElement.height !== videoHeight) {\r\n            canvasElement.height = videoHeight;\r\n        }\r\n\r\n        // Draw pose\r\n        drawPose(canvasCtx, results.poseLandmarks, videoWidth, videoHeight);\r\n\r\n        // Throttle accuracy calculations\r\n        const now = Date.now();\r\n        if (now - lastAccuracyUpdate >= ACCURACY_UPDATE_INTERVAL) {\r\n            if (selectedPose) {\r\n                const accuracyData = calculatePoseAccuracy(results.poseLandmarks, selectedPose);\r\n                setPoseAccuracy(accuracyData.total);\r\n                setSegmentAccuracies(accuracyData.segments);\r\n            }\r\n            setLastAccuracyUpdate(now);\r\n        }\r\n    }, [selectedPose, lastAccuracyUpdate, drawPose]);\r\n\r\n    useEffect(() => {\r\n        const loadPoses = async () => {\r\n            try {\r\n                setIsLoading(true);\r\n                setError(null);\r\n\r\n                // Default to 1 pose if no preferences\r\n                const count = userPreferences?.poseCount || 1;\r\n                console.log('Loading poses with count:', count);\r\n\r\n                // Load all poses up to the user's poseCount\r\n                const posesToLoad = poseNames.slice(0, count);\r\n                console.log('Poses to load:', posesToLoad);\r\n\r\n                const loadedPoses = await Promise.all(\r\n                    posesToLoad.map(async (poseName) => {\r\n                        try {\r\n                            const response = await fetch(`/pose_results/${poseName}_pose.json`);\r\n                            if (!response.ok) {\r\n                                throw new Error(`Failed to load pose: ${poseName}`);\r\n                            }\r\n                            const poseData = await response.json();\r\n                            return { ...poseData, name: poseName };\r\n                        } catch (err) {\r\n                            console.error(`Error loading pose ${poseName}:`, err);\r\n                            throw err;\r\n                        }\r\n                    })\r\n                );\r\n\r\n                console.log('Loaded poses:', loadedPoses);\r\n                setAvailablePoses(loadedPoses);\r\n                if (loadedPoses.length > 0) {\r\n                    setSelectedPose(loadedPoses[0]);\r\n                }\r\n                setIsLoading(false);\r\n            } catch (err) {\r\n                console.error('Error loading pose data:', err);\r\n                setError('Failed to load pose data. Please check your internet connection and try again.');\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n\r\n        if (userPreferences) {\r\n            loadPoses();\r\n        }\r\n    }, [userPreferences]);\r\n\r\n    const cleanup = useCallback(() => {\r\n        if (cleanupInProgressRef.current) return;\r\n        cleanupInProgressRef.current = true;\r\n\r\n        try {\r\n            if (cameraRef.current) {\r\n                cameraRef.current.stop();\r\n                cameraRef.current = null;\r\n            }\r\n            if (poseRef.current) {\r\n                poseRef.current.close();\r\n                poseRef.current = null;\r\n            }\r\n        } catch (err) {\r\n            console.error('Error during cleanup:', err);\r\n        } finally {\r\n            cleanupInProgressRef.current = false;\r\n        }\r\n    }, []);\r\n\r\n    // Timer effect for pose cycling\r\n    useEffect(() => {\r\n        if (!availablePoses.length || isSessionComplete || !isSessionStarted || isPaused) return;\r\n\r\n        const timer = setInterval(() => {\r\n            setTimeRemaining(prev => {\r\n                if (prev <= 1) {\r\n                    // Time to switch poses\r\n                    setCurrentPoseIndex(currentIndex => {\r\n                        const nextIndex = currentIndex + 1;\r\n                        // Increment completed poses count for the pose that just finished\r\n                        setTotalPosesCompleted(prev => prev + 1);\r\n\r\n                        if (nextIndex >= availablePoses.length) {\r\n                            setIsSessionComplete(true);\r\n                            cleanup();\r\n                            return currentIndex;\r\n                        }\r\n                        setSelectedPose(availablePoses[nextIndex]);\r\n                        return nextIndex;\r\n                    });\r\n                    return POSE_DURATION;\r\n                }\r\n                return prev - 1;\r\n            });\r\n        }, 1000);\r\n\r\n        return () => clearInterval(timer);\r\n    }, [availablePoses, isSessionComplete, cleanup, isSessionStarted, isPaused]);\r\n\r\n    // Handler for starting the session\r\n    const handleStartSession = useCallback(() => {\r\n        setIsSessionStarted(true);\r\n        setIsPaused(false);\r\n        setTimeRemaining(POSE_DURATION);\r\n        setTotalPosesCompleted(0);\r\n    }, []);\r\n\r\n    // Handler for pausing/resuming the session\r\n    const handlePauseResume = useCallback(() => {\r\n        setIsPaused(prev => !prev);\r\n    }, []);\r\n\r\n    // Handler for resetting the session\r\n    const handleReset = useCallback(() => {\r\n        cleanup();\r\n        setIsSessionStarted(false);\r\n        setIsPaused(false);\r\n        setIsSessionComplete(false);\r\n        setCurrentPoseIndex(0);\r\n        setTimeRemaining(POSE_DURATION);\r\n        setTotalPosesCompleted(0);\r\n        if (availablePoses.length > 0) {\r\n            setSelectedPose(availablePoses[0]);\r\n        }\r\n    }, [cleanup, availablePoses]);\r\n\r\n    // Initialize MediaPipe Pose with optimized settings\r\n    useEffect(() => {\r\n        const initializePose = async () => {\r\n            try {\r\n                setIsLoading(true);\r\n                setError(null);\r\n\r\n                cleanup();\r\n\r\n                const pose = new Pose({\r\n                    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`\r\n                });\r\n\r\n                pose.setOptions(poseOptions);\r\n                await pose.initialize();\r\n                pose.onResults(onResults);\r\n                poseRef.current = pose;\r\n\r\n                if (webcamRef.current?.video) {\r\n                    const camera = new Camera(webcamRef.current.video, {\r\n                        onFrame: async () => {\r\n                            if (webcamRef.current?.video && poseRef.current && !cleanupInProgressRef.current) {\r\n                                try {\r\n                                    await poseRef.current.send({\r\n                                        image: webcamRef.current.video,\r\n                                        timestamp: Date.now() // Add timestamp for better tracking\r\n                                    });\r\n                                } catch (err) {\r\n                                    if (!err.message?.includes('already deleted')) {\r\n                                        console.error('Error in pose detection frame:', err);\r\n                                    }\r\n                                }\r\n                            }\r\n                        },\r\n                        width: videoConstraints.width,\r\n                        height: videoConstraints.height,\r\n                        frameRate: videoConstraints.frameRate,\r\n                    });\r\n\r\n                    await camera.start();\r\n                    cameraRef.current = camera;\r\n                    setIsLoading(false);\r\n                }\r\n\r\n                setIsInitialized(true);\r\n            } catch (err) {\r\n                console.error('Error initializing pose detection:', err);\r\n                setError('Failed to initialize pose detection. Please ensure you have granted camera permissions and try again.');\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n\r\n        const timeoutId = setTimeout(() => {\r\n            if (webcamRef.current?.video) {\r\n                initializePose();\r\n            }\r\n        }, 1000);\r\n\r\n        return () => {\r\n            clearTimeout(timeoutId);\r\n            cleanup();\r\n        };\r\n    }, [onResults, cleanup, poseOptions, videoConstraints]);\r\n\r\n    // Cleanup on unmount\r\n    useEffect(() => {\r\n        return cleanup;\r\n    }, [cleanup]);\r\n\r\n    useEffect(() => {\r\n        // Initialize WebSocket connection\r\n        const ws = new WebSocket('ws://localhost:8000/ws/pose-feedback');\r\n\r\n        ws.onopen = () => {\r\n            console.log('Connected to feedback server');\r\n            setWsConnection(ws);\r\n        };\r\n\r\n        ws.onmessage = (event) => {\r\n            setPoseFeedback(event.data);\r\n        };\r\n\r\n        ws.onerror = (error) => {\r\n            console.error('WebSocket error:', error);\r\n        };\r\n\r\n        return () => {\r\n            if (ws) {\r\n                ws.close();\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    // Send pose data to backend when accuracy updates\r\n    useEffect(() => {\r\n        if (wsConnection && selectedPose && Object.keys(segmentAccuracies).length > 0) {\r\n            const poseData = {\r\n                pose_name: selectedPose.name || 'unknown pose',\r\n                overall_accuracy: poseAccuracy,\r\n                segment_accuracies: segmentAccuracies\r\n            };\r\n            wsConnection.send(JSON.stringify(poseData));\r\n        }\r\n    }, [poseAccuracy, segmentAccuracies, selectedPose, wsConnection]);\r\n\r\n    return (\r\n        <div className=\"pose-tracker\">\r\n            <div className=\"pose-header\">\r\n                <h1>Pose Tracking</h1>\r\n                {!isSessionComplete ? (\r\n                    <>\r\n                        {!isSessionStarted ? (\r\n                            <div className=\"session-controls\">\r\n                                <h3>Ready to start your yoga session?</h3>\r\n                                <p>You will perform {availablePoses.length} poses, holding each for {POSE_DURATION} seconds.</p>\r\n                                <button\r\n                                    className=\"start-button\"\r\n                                    onClick={handleStartSession}\r\n                                    disabled={!isInitialized || isLoading}\r\n                                >\r\n                                    Start Session\r\n                                </button>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"pose-info\">\r\n                                <h3>Current Pose: {selectedPose?.name?.replace(/-/g, ' ').replace(/_pose$/, '')}</h3>\r\n                                <div className=\"timer\">Time Remaining: {timeRemaining}s</div>\r\n                                <div className=\"progress\">\r\n                                    Pose {currentPoseIndex + 1} of {availablePoses.length || userPreferences?.poseCount || 1}\r\n                                </div>\r\n                                <div className=\"session-controls\">\r\n                                    <button\r\n                                        className={`control-button ${isPaused ? 'resume' : 'pause'}`}\r\n                                        onClick={handlePauseResume}\r\n                                    >\r\n                                        {isPaused ? 'Resume' : 'Pause'}\r\n                                    </button>\r\n                                    <button\r\n                                        className=\"control-button reset\"\r\n                                        onClick={handleReset}\r\n                                    >\r\n                                        Reset\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </>\r\n                ) : (\r\n                    <div className=\"session-complete\">\r\n                        <h3>Session Complete!</h3>\r\n                        <p>You completed {totalPosesCompleted} poses</p>\r\n                        <button\r\n                            className=\"start-button\"\r\n                            onClick={handleReset}\r\n                        >\r\n                            Start New Session\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"pose-container\">\r\n                <div className=\"webcam-section\">\r\n                    <div className=\"webcam-container\">\r\n                        <Webcam\r\n                            ref={webcamRef}\r\n                            videoConstraints={videoConstraints}\r\n                            style={{ display: 'block' }}\r\n                            mirrored={true}\r\n                            onUserMediaError={(err) => {\r\n                                console.error('Webcam error:', err);\r\n                                setError('Failed to access camera. Please ensure you have granted camera permissions.');\r\n                                setIsLoading(false);\r\n                            }}\r\n                        />\r\n                        <canvas ref={canvasRef} className=\"pose-canvas\" />\r\n                        {isLoading && (\r\n                            <div className=\"loading-overlay\">\r\n                                <div className=\"loading-spinner\"></div>\r\n                                <div>Loading pose detection...</div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"stats-section\">\r\n                    <div className=\"accuracy-card\">\r\n                        <h3>Overall Accuracy</h3>\r\n                        <div className=\"accuracy-value\">{poseAccuracy}%</div>\r\n                    </div>\r\n\r\n                    <div className=\"segment-accuracies\">\r\n                        {Object.entries(segmentAccuracies).map(([segment, data]) => (\r\n                            <div key={segment} className=\"segment-item\">\r\n                                <label>{segment.replace(/([A-Z])/g, ' $1').trim()}</label>\r\n                                <div className=\"accuracy-bar\">\r\n                                    <div\r\n                                        className=\"accuracy-fill\"\r\n                                        style={{ width: `${data.accuracy}%` }}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {poseFeedback && (\r\n                        <div className=\"feedback-message\">\r\n                            {poseFeedback}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {error && (\r\n                <div className=\"error-message\">\r\n                    <p>{error}</p>\r\n                    <button\r\n                        className=\"retry-button\"\r\n                        onClick={() => {\r\n                            setError(null);\r\n                            window.location.reload();\r\n                        }}\r\n                    >\r\n                        Retry\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PoseTracker;\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,MAAM,EAAEC,SAAS,EAAEC,QAAQ,EAAEC,WAAW,EAAEC,OAAO,QAAQ,OAAO;AAChF,OAAOC,MAAM,MAAM,cAAc;AACjC,SAASC,MAAM,QAAQ,yBAAyB;AAChD,SAASC,IAAI,QAAQ,iBAAiB;AACtC,OAAO,mBAAmB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAE3B,MAAMC,WAAW,GAAGA,CAAC;EAAEC;AAAgB,CAAC,KAAK;EAAAC,EAAA;EAAA,IAAAC,kBAAA;EACzC,MAAMC,SAAS,GAAGhB,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMiB,SAAS,GAAGjB,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMkB,OAAO,GAAGlB,MAAM,CAAC,IAAI,CAAC;EAC5B,MAAMmB,SAAS,GAAGnB,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMoB,oBAAoB,GAAGpB,MAAM,CAAC,KAAK,CAAC;EAC1C,MAAM,CAACqB,SAAS,EAAEC,YAAY,CAAC,GAAGpB,QAAQ,CAAC,IAAI,CAAC;EAChD,MAAM,CAACqB,KAAK,EAAEC,QAAQ,CAAC,GAAGtB,QAAQ,CAAC,IAAI,CAAC;EACxC,MAAM,CAACuB,YAAY,EAAEC,eAAe,CAAC,GAAGxB,QAAQ,CAAC,CAAC,CAAC;EACnD,MAAM,CAACyB,iBAAiB,EAAEC,oBAAoB,CAAC,GAAG1B,QAAQ,CAAC,CAAC,CAAC,CAAC;EAC9D,MAAM,CAAC2B,YAAY,EAAEC,eAAe,CAAC,GAAG5B,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAAC6B,YAAY,EAAEC,eAAe,CAAC,GAAG9B,QAAQ,CAAC,IAAI,CAAC;EACtD,MAAM,CAAC+B,YAAY,EAAEC,eAAe,CAAC,GAAGhC,QAAQ,CAAC,IAAI,CAAC;;EAEtD;EACA,MAAM,CAACiC,cAAc,EAAEC,iBAAiB,CAAC,GAAGlC,QAAQ,CAAC,EAAE,CAAC;EACxD,MAAM,CAACmC,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGpC,QAAQ,CAAC,CAAC,CAAC;EAC3D,MAAM,CAACqC,aAAa,EAAEC,gBAAgB,CAAC,GAAGtC,QAAQ,CAAC,EAAE,CAAC;EACtD,MAAM,CAACuC,iBAAiB,EAAEC,oBAAoB,CAAC,GAAGxC,QAAQ,CAAC,KAAK,CAAC;EACjE,MAAM,CAACyC,mBAAmB,EAAEC,sBAAsB,CAAC,GAAG1C,QAAQ,CAAC,CAAC,CAAC;;EAEjE;EACA,MAAM,CAAC2C,gBAAgB,EAAEC,mBAAmB,CAAC,GAAG5C,QAAQ,CAAC,KAAK,CAAC;EAC/D,MAAM,CAAC6C,QAAQ,EAAEC,WAAW,CAAC,GAAG9C,QAAQ,CAAC,KAAK,CAAC;EAC/C,MAAM,CAAC+C,aAAa,EAAEC,gBAAgB,CAAC,GAAGhD,QAAQ,CAAC,KAAK,CAAC;;EAEzD;EACA,MAAMiD,aAAa,GAAG,EAAE,CAAC,CAAC;EAC1B,MAAMC,SAAS,GAAG,CACd,gBAAgB,EAChB,cAAc,EACd,iBAAiB,EACjB,eAAe,EACf,qBAAqB,EACrB,WAAW,EACX,eAAe,EACf,mBAAmB,CACtB;;EAED;EACA,MAAMC,gBAAgB,GAAGjD,OAAO,CAAC,OAAO;IACpCkD,KAAK,EAAE,GAAG;IACVC,MAAM,EAAE,GAAG;IACXC,UAAU,EAAE,MAAM;IAClBC,SAAS,EAAE,EAAE,CAAE;EACnB,CAAC,CAAC,EAAE,EAAE,CAAC;;EAEP;EACA,MAAMC,WAAW,GAAGtD,OAAO,CAAC,OAAO;IAC/BuD,eAAe,EAAE,CAAC;IAClBC,eAAe,EAAE,IAAI;IACrBC,kBAAkB,EAAE,KAAK;IACzBC,kBAAkB,EAAE,KAAK;IACzBC,sBAAsB,EAAE,GAAG;IAC3BC,qBAAqB,EAAE,GAAG;IAC1BC,UAAU,EAAE;EAChB,CAAC,CAAC,EAAE,EAAE,CAAC;;EAEP;EACA,MAAM,CAACC,kBAAkB,EAAEC,qBAAqB,CAAC,GAAGjE,QAAQ,CAAC,CAAC,CAAC;EAC/D,MAAMkE,wBAAwB,GAAG,GAAG,CAAC,CAAC;;EAEtC,MAAMC,qBAAqB,GAAGA,CAACC,aAAa,EAAEC,UAAU,KAAK;IACzD,IAAI,CAACA,UAAU,IAAI,CAACD,aAAa,EAAE,OAAO;MAAEE,KAAK,EAAE,CAAC;MAAEC,QAAQ,EAAE,CAAC;IAAE,CAAC;;IAEpE;IACA,MAAMC,YAAY,GAAG;MACjBC,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;MACxCC,SAAS,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC;MAAE;MACrCC,KAAK,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC;MAAE;MACzBC,SAAS,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IACxC,CAAC;;IAED;IACA,MAAMC,cAAc,GAAG;MACnBJ,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;MAAE;MACjBC,SAAS,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC;MAAE;MACrBC,KAAK,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC;MAAE;MACzBC,SAAS,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IAChC,CAAC;;IAED;IACA,MAAME,aAAa,GAAIC,SAAS,IAAK;MACjC,MAAMC,YAAY,GAAGD,SAAS,CAAC,EAAE,CAAC;MAClC,MAAME,aAAa,GAAGF,SAAS,CAAC,EAAE,CAAC;MAEnC,MAAMG,eAAe,GAAG,CAACF,YAAY,CAACG,CAAC,GAAGF,aAAa,CAACE,CAAC,IAAI,CAAC;MAC9D,MAAMC,eAAe,GAAG,CAACJ,YAAY,CAACK,CAAC,GAAGJ,aAAa,CAACI,CAAC,IAAI,CAAC;MAC9D,MAAMC,aAAa,GAAGC,IAAI,CAACC,IAAI,CAC3BD,IAAI,CAACE,GAAG,CAACR,aAAa,CAACE,CAAC,GAAGH,YAAY,CAACG,CAAC,EAAE,CAAC,CAAC,GAC7CI,IAAI,CAACE,GAAG,CAACR,aAAa,CAACI,CAAC,GAAGL,YAAY,CAACK,CAAC,EAAE,CAAC,CAChD,CAAC;MAED,OAAON,SAAS,CAACW,GAAG,CAACC,QAAQ,KAAK;QAC9BR,CAAC,EAAE,CAACQ,QAAQ,CAACR,CAAC,GAAGD,eAAe,IAAII,aAAa;QACjDD,CAAC,EAAE,CAACM,QAAQ,CAACN,CAAC,GAAGD,eAAe,IAAIE,aAAa;QACjDM,UAAU,EAAED,QAAQ,CAACC;MACzB,CAAC,CAAC,CAAC;IACP,CAAC;;IAED;IACA,MAAMC,cAAc,GAAGf,aAAa,CAACV,aAAa,CAAC;IACnD,MAAM0B,gBAAgB,GAAGhB,aAAa,CAACT,UAAU,CAACU,SAAS,CAAC;IAE5D,IAAItD,iBAAiB,GAAG,CAAC,CAAC;IAC1B,IAAIsE,eAAe,GAAG,CAAC;;IAEvB;IACA,KAAK,MAAM,CAACC,OAAO,EAAEC,MAAM,CAAC,IAAIC,MAAM,CAACC,OAAO,CAAC3B,YAAY,CAAC,EAAE;MAC1D;MACA,MAAM4B,eAAe,GAAGvB,cAAc,CAACmB,OAAO,CAAC,CAACK,KAAK,CAACC,KAAK,IAAI;QAC3D,MAAMC,SAAS,GAAGV,cAAc,CAACS,KAAK,CAAC;QACvC,MAAME,WAAW,GAAGV,gBAAgB,CAACQ,KAAK,CAAC;QAC3C,OAAOC,SAAS,CAACX,UAAU,GAAG,GAAG,IAAIY,WAAW,CAACZ,UAAU,GAAG,GAAG;MACrE,CAAC,CAAC;MAEF,IAAI,CAACQ,eAAe,EAAE;QAClB,SAAS,CAAC;MACd;MAEA,IAAIK,YAAY,GAAG,CAAC;MACpB,IAAIC,aAAa,GAAG,CAAC;;MAErB;MACAT,MAAM,CAACU,OAAO,CAACL,KAAK,IAAI;QACpB,MAAMM,YAAY,GAAGf,cAAc,CAACS,KAAK,CAAC;QAC1C,MAAMO,cAAc,GAAGf,gBAAgB,CAACQ,KAAK,CAAC;;QAE9C;QACA,IAAIM,YAAY,CAAChB,UAAU,GAAG,GAAG,IAAIiB,cAAc,CAACjB,UAAU,GAAG,GAAG,EAAE;UAClE;UACA,MAAMkB,SAAS,GAAGvB,IAAI,CAACwB,KAAK,CAACH,YAAY,CAACvB,CAAC,EAAEuB,YAAY,CAACzB,CAAC,CAAC;UAC5D,MAAM6B,WAAW,GAAGzB,IAAI,CAACwB,KAAK,CAACF,cAAc,CAACxB,CAAC,EAAEwB,cAAc,CAAC1B,CAAC,CAAC;UAClE,MAAM8B,SAAS,GAAG1B,IAAI,CAAC2B,GAAG,CAACJ,SAAS,GAAGE,WAAW,CAAC;;UAEnD;UACA,MAAMG,QAAQ,GAAG5B,IAAI,CAACC,IAAI,CACtBD,IAAI,CAACE,GAAG,CAACmB,YAAY,CAACzB,CAAC,GAAG0B,cAAc,CAAC1B,CAAC,EAAE,CAAC,CAAC,GAC9CI,IAAI,CAACE,GAAG,CAACmB,YAAY,CAACvB,CAAC,GAAGwB,cAAc,CAACxB,CAAC,EAAE,CAAC,CACjD,CAAC;;UAED;UACA,MAAM+B,aAAa,GAAG7B,IAAI,CAAC8B,GAAG,CAAC,CAAC,EAAE,CAAC,GAAIJ,SAAS,GAAG1B,IAAI,CAAC+B,EAAG,CAAC;UAC5D,MAAMC,gBAAgB,GAAGhC,IAAI,CAAC8B,GAAG,CAAC,CAAC,EAAE,CAAC,GAAIF,QAAQ,GAAG,GAAI,CAAC;UAC1D,MAAMK,aAAa,GAAIJ,aAAa,GAAG,GAAG,GAAGG,gBAAgB,GAAG,GAAI;;UAEpE;UACA,MAAME,MAAM,GAAGlC,IAAI,CAACmC,GAAG,CAACd,YAAY,CAAChB,UAAU,EAAEiB,cAAc,CAACjB,UAAU,CAAC;UAC3Ea,YAAY,IAAIe,aAAa,GAAGC,MAAM;UACtCf,aAAa,IAAIe,MAAM;QAC3B;MACJ,CAAC,CAAC;;MAEF;MACA,IAAIf,aAAa,GAAG,CAAC,EAAE;QACnB,MAAMiB,WAAW,GAAIlB,YAAY,GAAGC,aAAa,GAAI,GAAG;QACxDjF,iBAAiB,CAACuE,OAAO,CAAC,GAAG;UACzB4B,QAAQ,EAAErC,IAAI,CAACmC,GAAG,CAAC,GAAG,EAAEnC,IAAI,CAAC8B,GAAG,CAAC,CAAC,EAAEM,WAAW,CAAC,CAAC;UACjD/B,UAAU,EAAEc,aAAa,GAAGT,MAAM,CAAC4B;QACvC,CAAC;QACD9B,eAAe,EAAE;MACrB;IACJ;;IAEA;IACA,IAAIA,eAAe,KAAK,CAAC,EAAE,OAAO;MAAEzB,KAAK,EAAE,CAAC;MAAEC,QAAQ,EAAE,CAAC;IAAE,CAAC;IAE5D,IAAIuD,aAAa,GAAG,CAAC;IACrB,IAAIC,WAAW,GAAG,CAAC;;IAEnB;IACA,MAAMC,cAAc,GAAG;MACnBvD,IAAI,EAAE,CAAC;MACPC,SAAS,EAAE,GAAG;MACdC,KAAK,EAAE,GAAG;MACVC,SAAS,EAAE;IACf,CAAC;IAED,KAAK,MAAM,CAACoB,OAAO,EAAEiC,IAAI,CAAC,IAAI/B,MAAM,CAACC,OAAO,CAAC1E,iBAAiB,CAAC,EAAE;MAC7D,MAAMgG,MAAM,GAAGO,cAAc,CAAChC,OAAO,CAAC,GAAGiC,IAAI,CAACrC,UAAU;MACxDkC,aAAa,IAAIG,IAAI,CAACL,QAAQ,GAAGH,MAAM;MACvCM,WAAW,IAAIN,MAAM;IACzB;IAEA,OAAO;MACHnD,KAAK,EAAEiB,IAAI,CAAC2C,KAAK,CAACH,WAAW,GAAG,CAAC,GAAGD,aAAa,GAAGC,WAAW,GAAG,CAAC,CAAC;MACpExD,QAAQ,EAAE9C;IACd,CAAC;EACL,CAAC;;EAED;EACA,MAAM0G,QAAQ,GAAGlI,WAAW,CAAC,CAACmI,SAAS,EAAErD,SAAS,EAAEsD,UAAU,EAAEC,WAAW,KAAK;IAC5E,IAAI,CAACF,SAAS,IAAI,CAACrD,SAAS,EAAE;;IAE9B;IACAqD,SAAS,CAACG,SAAS,GAAG,oBAAoB;IAC1CH,SAAS,CAACI,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAEH,UAAU,EAAEC,WAAW,CAAC;;IAEjD;IACAF,SAAS,CAACK,SAAS,CAAC,CAAC;IACrBL,SAAS,CAACM,SAAS,GAAG,CAAC;;IAEvB;IACA,MAAMC,WAAW,GAAG;MAChBlE,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MACtEC,SAAS,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;MAC7DC,KAAK,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;MACrCC,SAAS,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC;IACtD,CAAC;;IAED;IACAsB,MAAM,CAACC,OAAO,CAACwC,WAAW,CAAC,CAAChC,OAAO,CAAC,CAAC,CAACiC,IAAI,EAAEC,KAAK,CAAC,KAAK;MACnD,IAAIC,KAAK;MACT,QAAQF,IAAI;QACR,KAAK,MAAM;UAAEE,KAAK,GAAG,SAAS;UAAE;QAChC,KAAK,WAAW;UAAEA,KAAK,GAAG,SAAS;UAAE;QACrC,KAAK,OAAO;UAAEA,KAAK,GAAG,SAAS;UAAE;QACjC,KAAK,WAAW;UAAEA,KAAK,GAAG,SAAS;UAAE;QACrC;UAASA,KAAK,GAAG,SAAS;MAC9B;MAEAV,SAAS,CAACW,WAAW,GAAGD,KAAK;MAC7BV,SAAS,CAACK,SAAS,CAAC,CAAC;MAErBI,KAAK,CAAClC,OAAO,CAAC,CAAC,CAACqC,KAAK,EAAEC,GAAG,CAAC,KAAK;QAC5B,MAAMC,UAAU,GAAGnE,SAAS,CAACiE,KAAK,CAAC;QACnC,MAAMG,QAAQ,GAAGpE,SAAS,CAACkE,GAAG,CAAC;QAE/B,IAAIC,UAAU,CAACtD,UAAU,GAAG,GAAG,IAAIuD,QAAQ,CAACvD,UAAU,GAAG,GAAG,EAAE;UAC1DwC,SAAS,CAACgB,MAAM,CAACF,UAAU,CAAC/D,CAAC,GAAGkD,UAAU,EAAEa,UAAU,CAAC7D,CAAC,GAAGiD,WAAW,CAAC;UACvEF,SAAS,CAACiB,MAAM,CAACF,QAAQ,CAAChE,CAAC,GAAGkD,UAAU,EAAEc,QAAQ,CAAC9D,CAAC,GAAGiD,WAAW,CAAC;QACvE;MACJ,CAAC,CAAC;MAEFF,SAAS,CAACkB,MAAM,CAAC,CAAC;IACtB,CAAC,CAAC;;IAEF;IACAlB,SAAS,CAACG,SAAS,GAAG,SAAS;IAC/BH,SAAS,CAACW,WAAW,GAAG,SAAS;IAEjChE,SAAS,CAAC4B,OAAO,CAAChB,QAAQ,IAAI;MAC1B,IAAIA,QAAQ,CAACC,UAAU,GAAG,GAAG,EAAE;QAC3BwC,SAAS,CAACK,SAAS,CAAC,CAAC;QACrBL,SAAS,CAACmB,GAAG,CACT5D,QAAQ,CAACR,CAAC,GAAGkD,UAAU,EACvB1C,QAAQ,CAACN,CAAC,GAAGiD,WAAW,EACxB,CAAC;QAAE;QACH,CAAC,EACD,CAAC,GAAG/C,IAAI,CAAC+B,EACb,CAAC;QACDc,SAAS,CAACoB,IAAI,CAAC,CAAC;QAChBpB,SAAS,CAACkB,MAAM,CAAC,CAAC;MACtB;IACJ,CAAC,CAAC;EACN,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMG,SAAS,GAAGxJ,WAAW,CAAEyJ,OAAO,IAAK;IACvC,IAAI,CAAC3I,SAAS,CAAC4I,OAAO,IAAI,CAACD,OAAO,CAACE,aAAa,EAAE;IAElD,MAAMC,aAAa,GAAG9I,SAAS,CAAC4I,OAAO;IACvC,MAAMvB,SAAS,GAAGyB,aAAa,CAACC,UAAU,CAAC,IAAI,EAAE;MAAEC,KAAK,EAAE;IAAM,CAAC,CAAC,CAAC,CAAC;IACpE,MAAM1B,UAAU,GAAGvH,SAAS,CAAC6I,OAAO,CAACK,KAAK,CAAC3B,UAAU;IACrD,MAAMC,WAAW,GAAGxH,SAAS,CAAC6I,OAAO,CAACK,KAAK,CAAC1B,WAAW;;IAEvD;IACA,IAAIuB,aAAa,CAACzG,KAAK,KAAKiF,UAAU,EAAE;MACpCwB,aAAa,CAACzG,KAAK,GAAGiF,UAAU;IACpC;IACA,IAAIwB,aAAa,CAACxG,MAAM,KAAKiF,WAAW,EAAE;MACtCuB,aAAa,CAACxG,MAAM,GAAGiF,WAAW;IACtC;;IAEA;IACAH,QAAQ,CAACC,SAAS,EAAEsB,OAAO,CAACE,aAAa,EAAEvB,UAAU,EAAEC,WAAW,CAAC;;IAEnE;IACA,MAAM2B,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,IAAIA,GAAG,GAAGjG,kBAAkB,IAAIE,wBAAwB,EAAE;MACtD,IAAInC,YAAY,EAAE;QACd,MAAMoI,YAAY,GAAGhG,qBAAqB,CAACuF,OAAO,CAACE,aAAa,EAAE7H,YAAY,CAAC;QAC/EP,eAAe,CAAC2I,YAAY,CAAC7F,KAAK,CAAC;QACnC5C,oBAAoB,CAACyI,YAAY,CAAC5F,QAAQ,CAAC;MAC/C;MACAN,qBAAqB,CAACgG,GAAG,CAAC;IAC9B;EACJ,CAAC,EAAE,CAAClI,YAAY,EAAEiC,kBAAkB,EAAEmE,QAAQ,CAAC,CAAC;EAEhDpI,SAAS,CAAC,MAAM;IACZ,MAAMqK,SAAS,GAAG,MAAAA,CAAA,KAAY;MAC1B,IAAI;QACAhJ,YAAY,CAAC,IAAI,CAAC;QAClBE,QAAQ,CAAC,IAAI,CAAC;;QAEd;QACA,MAAM+I,KAAK,GAAG,CAAA1J,eAAe,aAAfA,eAAe,uBAAfA,eAAe,CAAE2J,SAAS,KAAI,CAAC;QAC7CC,OAAO,CAACC,GAAG,CAAC,2BAA2B,EAAEH,KAAK,CAAC;;QAE/C;QACA,MAAMI,WAAW,GAAGvH,SAAS,CAACwH,KAAK,CAAC,CAAC,EAAEL,KAAK,CAAC;QAC7CE,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEC,WAAW,CAAC;QAE1C,MAAME,WAAW,GAAG,MAAMC,OAAO,CAACC,GAAG,CACjCJ,WAAW,CAAC/E,GAAG,CAAC,MAAOoF,QAAQ,IAAK;UAChC,IAAI;YACA,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,iBAAiBF,QAAQ,YAAY,CAAC;YACnE,IAAI,CAACC,QAAQ,CAACE,EAAE,EAAE;cACd,MAAM,IAAIC,KAAK,CAAC,wBAAwBJ,QAAQ,EAAE,CAAC;YACvD;YACA,MAAMK,QAAQ,GAAG,MAAMJ,QAAQ,CAACK,IAAI,CAAC,CAAC;YACtC,OAAO;cAAE,GAAGD,QAAQ;cAAEE,IAAI,EAAEP;YAAS,CAAC;UAC1C,CAAC,CAAC,OAAOQ,GAAG,EAAE;YACVf,OAAO,CAAClJ,KAAK,CAAC,sBAAsByJ,QAAQ,GAAG,EAAEQ,GAAG,CAAC;YACrD,MAAMA,GAAG;UACb;QACJ,CAAC,CACL,CAAC;QAEDf,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEG,WAAW,CAAC;QACzCzI,iBAAiB,CAACyI,WAAW,CAAC;QAC9B,IAAIA,WAAW,CAAC9C,MAAM,GAAG,CAAC,EAAE;UACxB7F,eAAe,CAAC2I,WAAW,CAAC,CAAC,CAAC,CAAC;QACnC;QACAvJ,YAAY,CAAC,KAAK,CAAC;MACvB,CAAC,CAAC,OAAOkK,GAAG,EAAE;QACVf,OAAO,CAAClJ,KAAK,CAAC,0BAA0B,EAAEiK,GAAG,CAAC;QAC9ChK,QAAQ,CAAC,gFAAgF,CAAC;QAC1FF,YAAY,CAAC,KAAK,CAAC;MACvB;IACJ,CAAC;IAED,IAAIT,eAAe,EAAE;MACjByJ,SAAS,CAAC,CAAC;IACf;EACJ,CAAC,EAAE,CAACzJ,eAAe,CAAC,CAAC;EAErB,MAAM4K,OAAO,GAAGtL,WAAW,CAAC,MAAM;IAC9B,IAAIiB,oBAAoB,CAACyI,OAAO,EAAE;IAClCzI,oBAAoB,CAACyI,OAAO,GAAG,IAAI;IAEnC,IAAI;MACA,IAAI1I,SAAS,CAAC0I,OAAO,EAAE;QACnB1I,SAAS,CAAC0I,OAAO,CAAC6B,IAAI,CAAC,CAAC;QACxBvK,SAAS,CAAC0I,OAAO,GAAG,IAAI;MAC5B;MACA,IAAI3I,OAAO,CAAC2I,OAAO,EAAE;QACjB3I,OAAO,CAAC2I,OAAO,CAAC8B,KAAK,CAAC,CAAC;QACvBzK,OAAO,CAAC2I,OAAO,GAAG,IAAI;MAC1B;IACJ,CAAC,CAAC,OAAO2B,GAAG,EAAE;MACVf,OAAO,CAAClJ,KAAK,CAAC,uBAAuB,EAAEiK,GAAG,CAAC;IAC/C,CAAC,SAAS;MACNpK,oBAAoB,CAACyI,OAAO,GAAG,KAAK;IACxC;EACJ,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA5J,SAAS,CAAC,MAAM;IACZ,IAAI,CAACkC,cAAc,CAAC4F,MAAM,IAAItF,iBAAiB,IAAI,CAACI,gBAAgB,IAAIE,QAAQ,EAAE;IAElF,MAAM6I,KAAK,GAAGC,WAAW,CAAC,MAAM;MAC5BrJ,gBAAgB,CAACsJ,IAAI,IAAI;QACrB,IAAIA,IAAI,IAAI,CAAC,EAAE;UACX;UACAxJ,mBAAmB,CAACyJ,YAAY,IAAI;YAChC,MAAMC,SAAS,GAAGD,YAAY,GAAG,CAAC;YAClC;YACAnJ,sBAAsB,CAACkJ,IAAI,IAAIA,IAAI,GAAG,CAAC,CAAC;YAExC,IAAIE,SAAS,IAAI7J,cAAc,CAAC4F,MAAM,EAAE;cACpCrF,oBAAoB,CAAC,IAAI,CAAC;cAC1B+I,OAAO,CAAC,CAAC;cACT,OAAOM,YAAY;YACvB;YACA7J,eAAe,CAACC,cAAc,CAAC6J,SAAS,CAAC,CAAC;YAC1C,OAAOA,SAAS;UACpB,CAAC,CAAC;UACF,OAAO7I,aAAa;QACxB;QACA,OAAO2I,IAAI,GAAG,CAAC;MACnB,CAAC,CAAC;IACN,CAAC,EAAE,IAAI,CAAC;IAER,OAAO,MAAMG,aAAa,CAACL,KAAK,CAAC;EACrC,CAAC,EAAE,CAACzJ,cAAc,EAAEM,iBAAiB,EAAEgJ,OAAO,EAAE5I,gBAAgB,EAAEE,QAAQ,CAAC,CAAC;;EAE5E;EACA,MAAMmJ,kBAAkB,GAAG/L,WAAW,CAAC,MAAM;IACzC2C,mBAAmB,CAAC,IAAI,CAAC;IACzBE,WAAW,CAAC,KAAK,CAAC;IAClBR,gBAAgB,CAACW,aAAa,CAAC;IAC/BP,sBAAsB,CAAC,CAAC,CAAC;EAC7B,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMuJ,iBAAiB,GAAGhM,WAAW,CAAC,MAAM;IACxC6C,WAAW,CAAC8I,IAAI,IAAI,CAACA,IAAI,CAAC;EAC9B,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMM,WAAW,GAAGjM,WAAW,CAAC,MAAM;IAClCsL,OAAO,CAAC,CAAC;IACT3I,mBAAmB,CAAC,KAAK,CAAC;IAC1BE,WAAW,CAAC,KAAK,CAAC;IAClBN,oBAAoB,CAAC,KAAK,CAAC;IAC3BJ,mBAAmB,CAAC,CAAC,CAAC;IACtBE,gBAAgB,CAACW,aAAa,CAAC;IAC/BP,sBAAsB,CAAC,CAAC,CAAC;IACzB,IAAIT,cAAc,CAAC4F,MAAM,GAAG,CAAC,EAAE;MAC3B7F,eAAe,CAACC,cAAc,CAAC,CAAC,CAAC,CAAC;IACtC;EACJ,CAAC,EAAE,CAACsJ,OAAO,EAAEtJ,cAAc,CAAC,CAAC;;EAE7B;EACAlC,SAAS,CAAC,MAAM;IACZ,MAAMoM,cAAc,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI;QAAA,IAAAC,kBAAA;QACAhL,YAAY,CAAC,IAAI,CAAC;QAClBE,QAAQ,CAAC,IAAI,CAAC;QAEdiK,OAAO,CAAC,CAAC;QAET,MAAMc,IAAI,GAAG,IAAIhM,IAAI,CAAC;UAClBiM,UAAU,EAAGC,IAAI,IAAK,gDAAgDA,IAAI;QAC9E,CAAC,CAAC;QAEFF,IAAI,CAACG,UAAU,CAAChJ,WAAW,CAAC;QAC5B,MAAM6I,IAAI,CAACI,UAAU,CAAC,CAAC;QACvBJ,IAAI,CAAC5C,SAAS,CAACA,SAAS,CAAC;QACzBzI,OAAO,CAAC2I,OAAO,GAAG0C,IAAI;QAEtB,KAAAD,kBAAA,GAAItL,SAAS,CAAC6I,OAAO,cAAAyC,kBAAA,eAAjBA,kBAAA,CAAmBpC,KAAK,EAAE;UAC1B,MAAM0C,MAAM,GAAG,IAAItM,MAAM,CAACU,SAAS,CAAC6I,OAAO,CAACK,KAAK,EAAE;YAC/C2C,OAAO,EAAE,MAAAA,CAAA,KAAY;cAAA,IAAAC,mBAAA;cACjB,IAAI,CAAAA,mBAAA,GAAA9L,SAAS,CAAC6I,OAAO,cAAAiD,mBAAA,eAAjBA,mBAAA,CAAmB5C,KAAK,IAAIhJ,OAAO,CAAC2I,OAAO,IAAI,CAACzI,oBAAoB,CAACyI,OAAO,EAAE;gBAC9E,IAAI;kBACA,MAAM3I,OAAO,CAAC2I,OAAO,CAACkD,IAAI,CAAC;oBACvBC,KAAK,EAAEhM,SAAS,CAAC6I,OAAO,CAACK,KAAK;oBAC9B+C,SAAS,EAAE7C,IAAI,CAACD,GAAG,CAAC,CAAC,CAAC;kBAC1B,CAAC,CAAC;gBACN,CAAC,CAAC,OAAOqB,GAAG,EAAE;kBAAA,IAAA0B,YAAA;kBACV,IAAI,GAAAA,YAAA,GAAC1B,GAAG,CAAC2B,OAAO,cAAAD,YAAA,eAAXA,YAAA,CAAaE,QAAQ,CAAC,iBAAiB,CAAC,GAAE;oBAC3C3C,OAAO,CAAClJ,KAAK,CAAC,gCAAgC,EAAEiK,GAAG,CAAC;kBACxD;gBACJ;cACJ;YACJ,CAAC;YACDlI,KAAK,EAAED,gBAAgB,CAACC,KAAK;YAC7BC,MAAM,EAAEF,gBAAgB,CAACE,MAAM;YAC/BE,SAAS,EAAEJ,gBAAgB,CAACI;UAChC,CAAC,CAAC;UAEF,MAAMmJ,MAAM,CAAC1D,KAAK,CAAC,CAAC;UACpB/H,SAAS,CAAC0I,OAAO,GAAG+C,MAAM;UAC1BtL,YAAY,CAAC,KAAK,CAAC;QACvB;QAEA4B,gBAAgB,CAAC,IAAI,CAAC;MAC1B,CAAC,CAAC,OAAOsI,GAAG,EAAE;QACVf,OAAO,CAAClJ,KAAK,CAAC,oCAAoC,EAAEiK,GAAG,CAAC;QACxDhK,QAAQ,CAAC,uGAAuG,CAAC;QACjHF,YAAY,CAAC,KAAK,CAAC;MACvB;IACJ,CAAC;IAED,MAAM+L,SAAS,GAAGC,UAAU,CAAC,MAAM;MAAA,IAAAC,mBAAA;MAC/B,KAAAA,mBAAA,GAAIvM,SAAS,CAAC6I,OAAO,cAAA0D,mBAAA,eAAjBA,mBAAA,CAAmBrD,KAAK,EAAE;QAC1BmC,cAAc,CAAC,CAAC;MACpB;IACJ,CAAC,EAAE,IAAI,CAAC;IAER,OAAO,MAAM;MACTmB,YAAY,CAACH,SAAS,CAAC;MACvB5B,OAAO,CAAC,CAAC;IACb,CAAC;EACL,CAAC,EAAE,CAAC9B,SAAS,EAAE8B,OAAO,EAAE/H,WAAW,EAAEL,gBAAgB,CAAC,CAAC;;EAEvD;EACApD,SAAS,CAAC,MAAM;IACZ,OAAOwL,OAAO;EAClB,CAAC,EAAE,CAACA,OAAO,CAAC,CAAC;EAEbxL,SAAS,CAAC,MAAM;IACZ;IACA,MAAMwN,EAAE,GAAG,IAAIC,SAAS,CAAC,sCAAsC,CAAC;IAEhED,EAAE,CAACE,MAAM,GAAG,MAAM;MACdlD,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC;MAC3C1I,eAAe,CAACyL,EAAE,CAAC;IACvB,CAAC;IAEDA,EAAE,CAACG,SAAS,GAAIC,KAAK,IAAK;MACtB/L,eAAe,CAAC+L,KAAK,CAAC1F,IAAI,CAAC;IAC/B,CAAC;IAEDsF,EAAE,CAACK,OAAO,GAAIvM,KAAK,IAAK;MACpBkJ,OAAO,CAAClJ,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;IAC5C,CAAC;IAED,OAAO,MAAM;MACT,IAAIkM,EAAE,EAAE;QACJA,EAAE,CAAC9B,KAAK,CAAC,CAAC;MACd;IACJ,CAAC;EACL,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA1L,SAAS,CAAC,MAAM;IACZ,IAAI8B,YAAY,IAAIE,YAAY,IAAImE,MAAM,CAAC2H,IAAI,CAACpM,iBAAiB,CAAC,CAACoG,MAAM,GAAG,CAAC,EAAE;MAC3E,MAAMsD,QAAQ,GAAG;QACb2C,SAAS,EAAE/L,YAAY,CAACsJ,IAAI,IAAI,cAAc;QAC9C0C,gBAAgB,EAAExM,YAAY;QAC9ByM,kBAAkB,EAAEvM;MACxB,CAAC;MACDI,YAAY,CAACgL,IAAI,CAACoB,IAAI,CAACC,SAAS,CAAC/C,QAAQ,CAAC,CAAC;IAC/C;EACJ,CAAC,EAAE,CAAC5J,YAAY,EAAEE,iBAAiB,EAAEM,YAAY,EAAEF,YAAY,CAAC,CAAC;EAEjE,oBACItB,OAAA;IAAK4N,SAAS,EAAC,cAAc;IAAAC,QAAA,gBACzB7N,OAAA;MAAK4N,SAAS,EAAC,aAAa;MAAAC,QAAA,gBACxB7N,OAAA;QAAA6N,QAAA,EAAI;MAAa;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,EACrB,CAACjM,iBAAiB,gBACfhC,OAAA,CAAAE,SAAA;QAAA2N,QAAA,EACK,CAACzL,gBAAgB,gBACdpC,OAAA;UAAK4N,SAAS,EAAC,kBAAkB;UAAAC,QAAA,gBAC7B7N,OAAA;YAAA6N,QAAA,EAAI;UAAiC;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eAC1CjO,OAAA;YAAA6N,QAAA,GAAG,mBAAiB,EAACnM,cAAc,CAAC4F,MAAM,EAAC,2BAAyB,EAAC5E,aAAa,EAAC,WAAS;UAAA;YAAAoL,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAG,CAAC,eAChGjO,OAAA;YACI4N,SAAS,EAAC,cAAc;YACxBM,OAAO,EAAEzC,kBAAmB;YAC5B0C,QAAQ,EAAE,CAAC3L,aAAa,IAAI5B,SAAU;YAAAiN,QAAA,EACzC;UAED;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACR,CAAC,gBAENjO,OAAA;UAAK4N,SAAS,EAAC,WAAW;UAAAC,QAAA,gBACtB7N,OAAA;YAAA6N,QAAA,GAAI,gBAAc,EAACrM,YAAY,aAAZA,YAAY,wBAAAlB,kBAAA,GAAZkB,YAAY,CAAEsJ,IAAI,cAAAxK,kBAAA,uBAAlBA,kBAAA,CAAoB8N,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC;UAAA;YAAAN,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,eACrFjO,OAAA;YAAK4N,SAAS,EAAC,OAAO;YAAAC,QAAA,GAAC,kBAAgB,EAAC/L,aAAa,EAAC,GAAC;UAAA;YAAAgM,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,eAC7DjO,OAAA;YAAK4N,SAAS,EAAC,UAAU;YAAAC,QAAA,GAAC,OACjB,EAACjM,gBAAgB,GAAG,CAAC,EAAC,MAAI,EAACF,cAAc,CAAC4F,MAAM,KAAIlH,eAAe,aAAfA,eAAe,uBAAfA,eAAe,CAAE2J,SAAS,KAAI,CAAC;UAAA;YAAA+D,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACvF,CAAC,eACNjO,OAAA;YAAK4N,SAAS,EAAC,kBAAkB;YAAAC,QAAA,gBAC7B7N,OAAA;cACI4N,SAAS,EAAE,kBAAkBtL,QAAQ,GAAG,QAAQ,GAAG,OAAO,EAAG;cAC7D4L,OAAO,EAAExC,iBAAkB;cAAAmC,QAAA,EAE1BvL,QAAQ,GAAG,QAAQ,GAAG;YAAO;cAAAwL,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAC1B,CAAC,eACTjO,OAAA;cACI4N,SAAS,EAAC,sBAAsB;cAChCM,OAAO,EAAEvC,WAAY;cAAAkC,QAAA,EACxB;YAED;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACR,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACL;MACR,gBACH,CAAC,gBAEHjO,OAAA;QAAK4N,SAAS,EAAC,kBAAkB;QAAAC,QAAA,gBAC7B7N,OAAA;UAAA6N,QAAA,EAAI;QAAiB;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eAC1BjO,OAAA;UAAA6N,QAAA,GAAG,gBAAc,EAAC3L,mBAAmB,EAAC,QAAM;QAAA;UAAA4L,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG,CAAC,eAChDjO,OAAA;UACI4N,SAAS,EAAC,cAAc;UACxBM,OAAO,EAAEvC,WAAY;UAAAkC,QAAA,EACxB;QAED;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACR,CACR;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACA,CAAC,eAENjO,OAAA;MAAK4N,SAAS,EAAC,gBAAgB;MAAAC,QAAA,gBAC3B7N,OAAA;QAAK4N,SAAS,EAAC,gBAAgB;QAAAC,QAAA,eAC3B7N,OAAA;UAAK4N,SAAS,EAAC,kBAAkB;UAAAC,QAAA,gBAC7B7N,OAAA,CAACJ,MAAM;YACHyO,GAAG,EAAE9N,SAAU;YACfqC,gBAAgB,EAAEA,gBAAiB;YACnC0L,KAAK,EAAE;cAAEC,OAAO,EAAE;YAAQ,CAAE;YAC5BC,QAAQ,EAAE,IAAK;YACfC,gBAAgB,EAAG1D,GAAG,IAAK;cACvBf,OAAO,CAAClJ,KAAK,CAAC,eAAe,EAAEiK,GAAG,CAAC;cACnChK,QAAQ,CAAC,6EAA6E,CAAC;cACvFF,YAAY,CAAC,KAAK,CAAC;YACvB;UAAE;YAAAiN,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACL,CAAC,eACFjO,OAAA;YAAQqO,GAAG,EAAE7N,SAAU;YAACoN,SAAS,EAAC;UAAa;YAAAE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,EACjDrN,SAAS,iBACNZ,OAAA;YAAK4N,SAAS,EAAC,iBAAiB;YAAAC,QAAA,gBAC5B7N,OAAA;cAAK4N,SAAS,EAAC;YAAiB;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACvCjO,OAAA;cAAA6N,QAAA,EAAK;YAAyB;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAK,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACnC,CACR;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACA;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACL,CAAC,eAENjO,OAAA;QAAK4N,SAAS,EAAC,eAAe;QAAAC,QAAA,gBAC1B7N,OAAA;UAAK4N,SAAS,EAAC,eAAe;UAAAC,QAAA,gBAC1B7N,OAAA;YAAA6N,QAAA,EAAI;UAAgB;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eACzBjO,OAAA;YAAK4N,SAAS,EAAC,gBAAgB;YAAAC,QAAA,GAAE7M,YAAY,EAAC,GAAC;UAAA;YAAA8M,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACpD,CAAC,eAENjO,OAAA;UAAK4N,SAAS,EAAC,oBAAoB;UAAAC,QAAA,EAC9BlI,MAAM,CAACC,OAAO,CAAC1E,iBAAiB,CAAC,CAACiE,GAAG,CAAC,CAAC,CAACM,OAAO,EAAEiC,IAAI,CAAC,kBACnD1H,OAAA;YAAmB4N,SAAS,EAAC,cAAc;YAAAC,QAAA,gBACvC7N,OAAA;cAAA6N,QAAA,EAAQpI,OAAO,CAAC2I,OAAO,CAAC,UAAU,EAAE,KAAK,CAAC,CAACM,IAAI,CAAC;YAAC;cAAAZ,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,eAC1DjO,OAAA;cAAK4N,SAAS,EAAC,cAAc;cAAAC,QAAA,eACzB7N,OAAA;gBACI4N,SAAS,EAAC,eAAe;gBACzBU,KAAK,EAAE;kBAAEzL,KAAK,EAAE,GAAG6E,IAAI,CAACL,QAAQ;gBAAI;cAAE;gBAAAyG,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACzC;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACD,CAAC;UAAA,GAPAxI,OAAO;YAAAqI,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAQZ,CACR;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACD,CAAC,EAEL7M,YAAY,iBACTpB,OAAA;UAAK4N,SAAS,EAAC,kBAAkB;UAAAC,QAAA,EAC5BzM;QAAY;UAAA0M,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACZ,CACR;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACA,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC,EAELnN,KAAK,iBACFd,OAAA;MAAK4N,SAAS,EAAC,eAAe;MAAAC,QAAA,gBAC1B7N,OAAA;QAAA6N,QAAA,EAAI/M;MAAK;QAAAgN,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eACdjO,OAAA;QACI4N,SAAS,EAAC,cAAc;QACxBM,OAAO,EAAEA,CAAA,KAAM;UACXnN,QAAQ,CAAC,IAAI,CAAC;UACd4N,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC;QAC5B,CAAE;QAAAhB,QAAA,EACL;MAED;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACR,CACR;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACA,CAAC;AAEd,CAAC;AAAC5N,EAAA,CAnoBIF,WAAW;AAAA2O,EAAA,GAAX3O,WAAW;AAqoBjB,eAAeA,WAAW;AAAC,IAAA2O,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}